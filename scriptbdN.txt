CREATE TABLE pessoa(
idpessoa int GENERATED ALWAYS AS IDENTITY not null primary key,
cpf varchar(11) not null,
nome varchar(50) not null,
datanascimento Date not null,
email varchar(50) not null,
senha varchar(30) not null,
telefone varchar(11) not null,
idendereco integer not null,
isPaciente boolean,
isMedico boolean,
isAdmin boolean,
inactivatedAt Date,
createdAt Date DEFAULT CURRENT_TIMESTAMP,
updatedAt Date DEFAULT CURRENT_TIMESTAMP,
CONSTRAINT fk_id_endereco FOREIGN KEY (idendereco) REFERENCES endereco (idendereco)
);

CREATE TABLE medico(
idmedico int GENERATED ALWAYS AS IDENTITY not null primary key,
crm  varchar(11) not null,
idpessoa int not null,
ufcrm varchar(60),
inactivatedAt Date,
createdAt Date DEFAULT CURRENT_TIMESTAMP,
updatedAt Date DEFAULT CURRENT_TIMESTAMP,
CONSTRAINT fk_medico_pessoa
FOREIGN KEY (idpessoa) REFERENCES pessoa(idpessoa)
);

CREATE TABLE estado(
idestado int GENERATED ALWAYS AS IDENTITY not null primary key,
nomeestado varchar(40) not null,
siglaestado varchar(2) not null,
createdAt Date DEFAULT CURRENT_TIMESTAMP,
updatedAt Date DEFAULT CURRENT_TIMESTAMP);

CREATE TABLE cidade(
idcidade int GENERATED ALWAYS AS IDENTITY not null primary key,
nomecidade varchar(60) not null,
idestado integer not null,
createdAt Date DEFAULT CURRENT_TIMESTAMP,
updatedAt Date DEFAULT CURRENT_TIMESTAMP,
CONSTRAINT fk_cidade_estado
FOREIGN KEY (idestado)
REFERENCES estado(idestado)
);

CREATE TABLE endereco(
idendereco int GENERATED ALWAYS AS IDENTITY not null primary key,
idcidade int not null,
idestado int not null,
rua varchar(60) not null,
numero integer not null,
bairro varchar(70) not null,
cep varchar (8) not null,
inactivatedAt Date,
createdAt Date DEFAULT CURRENT_TIMESTAMP,
updatedAt Date DEFAULT CURRENT_TIMESTAMP,
CONSTRAINT fk_endereco_cidade FOREIGN KEY (idcidade) REFERENCES cidade(idcidade),
CONSTRAINT fk_endereco_estado FOREIGN KEY (idestado) REFERENCES estado(idestado)
);


UPDATE c SET m.inactivatedAt = p.inactivatedAt
FROM endereco e INNER JOIN pessoa p ON p.idpessoa = e.idpessoa where idpessoa = ?